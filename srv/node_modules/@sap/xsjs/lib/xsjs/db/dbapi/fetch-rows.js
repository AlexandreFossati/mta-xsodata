'use strict';

var dbStream = require('@sap/hana-client/extension/Stream');

module.exports = fetchRows;

function fetchRows(resultSet, streamType, cb) {
  var rows = [];

  var stream = (streamType === 'array') ?
    dbStream.createArrayStream(resultSet) :
    dbStream.createObjectStream(resultSet);

  stream.on('readable', function () {
    var data;
    while ((data = stream.read()) !== null) {
      rows.push(data);
    }
  });

  stream.once('error', function (err) {
    stream.removeAllListeners();
    cb(err);
  });

  stream.on('end', function () {
    stream.removeAllListeners();
    cb(null, rows);
  });

}
